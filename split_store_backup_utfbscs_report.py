import osimport reimport shutilimport ctypesdll = ctypes.windll.trashanimetitle_long = ["スクールガールストライカーズ",                   "リトルウィッチアカデミア",                   "ガヴリールドロップアウト",                   "小林さんちのメイドラゴン",                   "新世紀エヴァンゲリオン",                   "南鎌倉高校女子自転車部",                   "亜人ちゃんは語りたい",                   "ＴＲＩＣＫＳＴＥＲ",                   "政宗くんのリベンジ",                   "チェインクロニクル",                   "タイムボカン２４",                   "ハンドシェイカー",                   "カオスチャイルド",                   "四畳半神話大系",                   "３月のライオン",                   "Ｒｅｗｒｉｔｅ",                   "うらら迷路帖",                   "ゼスティリア",                   "クズの本懐",                   "ＡＫＩＢＡ",                   "セイレン",                   "幼女戦記",                   "区監察課",                   "風夏",                  ]animetitle_short = []animetitle = animetitle_long + animetitle_shortutf = ['チャンネル:ＴＯＫＹＯ\u3000ＭＸ１\n',       'チャンネル:テレビ東京１\n',       'チャンネル:ＴＢＳ１\n',       'チャンネル:日テレ１\n',       'チャンネル:フジテレビ\n',       'チャンネル:テレビ愛知１\n',       'チャンネル:中京テレビ１\n',       'チャンネル:ＣＢＣテレビ\n',       'チャンネル:東海テレビ０１１\n',       ]bscs = ['チャンネル:ＢＳ１１\n',        'チャンネル:ＢＳアニマックス\n',        'チャンネル:ＢＳフジ・１８１\n',]def existHDST(title):    for file in os.listdir():        if re.search(title+".*HD(-\d)?.*\.ts",file):            return 1        else:            pass    return 0def error_or_drop(file):    is_error_or_drop = 0    for line in open(file,errors='ignore').readlines():        if ((re.search("総パケットエラー数",line)             and (not re.search("総パケットエラー数:0",line)))            or            (re.search("総パケットドロップ数",line)             and (not re.search("総パケットドロップ数:0",line)))):            is_error_or_drop = 1        else:            pass    return is_error_or_dropfor title in animetitle:    if not os.path.exists("UTF\\"+title):        os.mkdir("UTF\\"+title)    if not os.path.exists("BS\\"+title):        os.mkdir("BS\\"+title)if not os.path.exists("その他"):    os.mkdir("その他")for title in animetitle:    for file in os.listdir():        if re.search(title+".*\.txt",file):            if error_or_drop(file):                print(file.split('.')[0])                for line in open(file,errors='ignore').readlines():                    if re.search("チャンネル",line):                        print(line.rstrip().split(":")[-1],end=", ")                    elif re.search("総パケットエラー数",line):                        print(line.rstrip(),end=", ")                    elif re.search("総パケットドロップ数",line):                        print(line.rstrip()+'\n')                    else:                        passfor title in animetitle_long:    for file in os.listdir():        if re.search(title+".*\.ts",file):            #os.system("TsSplitter -SD -1SEG -SEP2 -SEPA "+file)            passfor title in animetitle_long:    for file in os.listdir():        if re.search(title+".*\.ts",file) and 1024 ** 3 > os.path.getsize(file):            dll.trash(file)for title in animetitle:    for file in os.listdir():        if re.search(title+".*HD(-\d)?\.ts",file):            dll.trash(file.split('_')[0]+'.ts')for title in animetitle:    if existHDST(title):        for file in os.listdir():            if re.search(title+".*HD(-\d)?.*\.ts",file):                if open(file.split('_')[0]+'.txt', 'r', errors='ignore').readline() in utf:                    shutil.move(file,"UTF\\"+title)                else:                    shutil.move(file,"BS\\"+title)            elif re.search(title+".*\.ts",file):                if open(file.split('.')[0]+'.txt', 'r', errors='ignore').readline() in utf:                    shutil.move(file,"UTF\\"+title)                else:                    shutil.move(file,"BS\\"+title)            else:                pass    else:        for file in os.listdir():            if re.search(title+".*\.ts",file):                if open(file.split('.')[0]+'.txt', 'r', errors='ignore').readline() in utf:                    shutil.move(file,"UTF\\"+title)                else:                    shutil.move(file,"BS\\"+title)            else:                passfor file in os.listdir():    if os.path.splitext(file)[1] == ".ts":        shutil.move(file,"その他")for title in animetitle:    for file in os.listdir():        if re.search(title+".*\.txt",file):            dll.trash(file)for title in animetitle:    if not os.path.exists("F:\\animebackup\\UTF\\"+title):        os.mkdir("F:\\animebackup\\UTF\\"+title)    if not os.path.exists("F:\\animebackup\\BS\\"+title):        os.mkdir("F:\\animebackup\\BS\\"+title)uncopyed_num = 0copyed_num = 0for title in animetitle:    uncopyed_num += len(list(set(os.listdir("D:\\animeonair\\UTF\\"+title))                             -set(os.listdir("F:\\animebackup\\UTF\\"+title))))    uncopyed_num += len(list(set(os.listdir("D:\\animeonair\\BS\\"+title))                             -set(os.listdir("F:\\animebackup\\BS\\"+title))))for title in animetitle:    for uncopyed in list(set(os.listdir("D:\\animeonair\\UTF\\"+title))                         -set(os.listdir("F:\\animebackup\\UTF\\"+title))):        copyed_num += 1        print("copying %d/%d" % (copyed_num,uncopyed_num))        print(uncopyed)        shutil.copy("D:\\animeonair\\UTF\\"+title+"\\"+uncopyed,"F:\\animebackup\\UTF\\"+title)    for uncopyed in list(set(os.listdir("D:\\animeonair\\BS\\"+title))                         -set(os.listdir("F:\\animebackup\\BS\\"+title))):        copyed_num += 1        print("copying %d/%d" % (copyed_num,uncopyed_num))        print(uncopyed)        shutil.copy("D:\\animeonair\\BS\\"+title+"\\"+uncopyed,"F:\\animebackup\\BS\\"+title)
